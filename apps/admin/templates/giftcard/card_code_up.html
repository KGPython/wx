{% extends 'base/commont.html' %}
{% load myFilter %}
{% block current_page %}
    <a href="#">礼品卡</a>
    <a href="#">卡实例</a>
    <a href="#" class="current">上传Code</a>
{% endblock %}
{% block content_r %}
    <style>.card_list {
        background-color: #eee
    }</style>
    <div class="row-fluid">
        <div class="box span12">
            <div class="box-header">
                <h2>
                    <i class="icon-align-justify"></i>
                    <span class="break"></span>
                    异常数据查询
                </h2>
            </div>
            <div class="box-content">
                <div class="alert alert-block ">
                    <h4 class="alert-heading">警告!!!!!!</h4>
                    <p>
                        单次上传Code数量不能超过100个！
                    </p>
                </div>

                <form action="{% url 'admin:giftcard:card_code_upload_manual' wx_card_id %}" method="post" class="form-horizontal">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="query">
                    <div class="list">
                        <div class="row-fluid">
                            <div class="control-group span3">
                                <label class="control-label">起始Code:</label>
                                <div class="controls">
                                    <input name="start[]" type="text">
                                </div>
                            </div>
                            <div class="control-group span3">
                                <label class="control-label">截至Code:</label>
                                <div class="controls">
                                    <input name="end[]" type="text">
                                </div>
                            </div>
                            <div class="control-group span2 list-item-btn">
                                <button type="button" class="btn btn-small btn-success" onclick="addFormRow(this)">
                                    添加 <i class="icon-plus"></i>
                                </button>
                                <button type="button" class="btn btn-small btn-danger" onclick="delFormRow(this)">
                                    删除 <i class="icon-minus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary">查询</button>
                        <input class="btn btn-primary" type="button" value="上传" onclick="uploadeCode()">
                    </div>
                </form>

                {% if codes_error %}
                    <div class="alert alert-error">
                        <strong>异常Code!</strong> {{ codes_error }}.
                    </div>
                {% endif %}
                {% if codes_correct %}
                    <div class="alert alert-info">
                        <strong>正常Code!</strong> {{ codes_correct }}.
                        <div class="row-fluid">
                            <button type="button" class="btn btn-primary pull-right" onclick="uploadeCode()">上传</button>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
{% block common_js %}
    <script type="text/javascript">
    function uploadeCode() {
        var codes_correct = {{ codes_correct | safe }};
        $.post(
                "{% url 'admin:giftcard:card_code_upload_manual' wx_card_id %}",
                {
                    codes:codes_correct,
                    action : 'upload',
                    csrfmiddlewaretoken:'{{ csrf_token }}'
                },
                function (data) {
                    if(data.status == 0){
                        noty({"text": "数据提交成", "layout": "bottom", "type": "information"});
                        window.location.href = "{% url 'admin:giftcard:cards' %}"
                    }else {
                        text = data.msg;
                        noty({"text": text, "layout": "bottom", "type": "error"});
                    }
                },
                'json'
        )
    }

    </script>
{% endblock %}